# ğŸ¯ å®ç°å¾®åš/å°çº¢ä¹¦å¼å¸é¡¶æ•ˆæœ

## ğŸ“± æ•ˆæœæ¼”ç¤º

### ä½ æƒ³è¦çš„æ•ˆæœ

```
ã€åˆå§‹çŠ¶æ€ã€‘
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ® ViewController-Based    â”‚ â† Section 0: é¡¶éƒ¨å†…å®¹ï¼ˆæ‰€æœ‰åˆ†é¡µå…±äº«ï¼‰
â”‚  (200pt é«˜åº¦)               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ [Overview][Details][Analytics] â”‚ â† Segment Header
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Page å†…å®¹                   â”‚ â† Section 1: åˆ†é¡µå†…å®¹
â”‚  â€¢ Item 1                   â”‚
â”‚  â€¢ Item 2                   â”‚
â”‚  â€¢ Item 3                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â¬‡ï¸ å‘ä¸Šæ»šåŠ¨

ã€æ»šåŠ¨ä¸­ - ä¸€èµ·å‘ä¸Šç§»åŠ¨ã€‘
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ViewController-Based       â”‚ â† é¡¶éƒ¨å†…å®¹å‘ä¸Šæ»šåŠ¨
â”‚                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ [Overview][Details][Analytics] â”‚ â† Segment ä¹Ÿåœ¨å‘ä¸Šç§»åŠ¨
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â€¢ Item 3                   â”‚
â”‚  â€¢ Item 4                   â”‚ â† Page å†…å®¹ä¹Ÿåœ¨æ»šåŠ¨
â”‚  â€¢ Item 5                   â”‚
â”‚  â€¢ Item 6                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â¬‡ï¸ ç»§ç»­æ»šåŠ¨

ã€Segment åˆ°è¾¾é¡¶éƒ¨ - å¸é¡¶ï¼ã€‘
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ [Overview][Details][Analytics] â”‚ â† Segment å¸é™„åœ¨å¯¼èˆªæ ä¸‹æ–¹
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â€¢ Item 8                   â”‚
â”‚  â€¢ Item 9                   â”‚ â† åªæœ‰ Page å†…å®¹ç»§ç»­æ»šåŠ¨
â”‚  â€¢ Item 10                  â”‚
â”‚  â€¢ Item 11                  â”‚
â”‚  â€¢ Item 12                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â†‘
    é¡¶éƒ¨å†…å®¹å·²ç»å®Œå…¨æ»šå‡ºå±å¹•
```

---

## âœ… å®ç°åŸç†

### å…³é”®é…ç½®

```swift
private func createPagingSection() -> NSCollectionLayoutSection {
    // ... section é…ç½®
    
    let header = NSCollectionLayoutBoundarySupplementaryItem(
        layoutSize: .init(widthDimension: .fractionalWidth(1.0), heightDimension: .absolute(44)),
        elementKind: UICollectionView.elementKindSectionHeader,
        alignment: .top
    )
    
    // â­â­â­ æ ¸å¿ƒè®¾ç½®
    header.pinToVisibleBounds = true  // å¸é¡¶æ•ˆæœ
    header.zIndex = 2                 // ç¡®ä¿åœ¨æœ€ä¸Šå±‚
    
    section.boundarySupplementaryItems = [header]
    return section
}
```

### å·¥ä½œåŸç†

1. **Section 0 (é¡¶éƒ¨å†…å®¹)**
   - é«˜åº¦å›ºå®š 200pt
   - æ™®é€šçš„ Cellï¼Œä¼šéšæ»šåŠ¨ç§»åŠ¨
   - æ»šåŠ¨æ—¶ä¼šå‘ä¸Šç§»å‡ºå±å¹•

2. **Section 1 çš„ Header (Segment)**
   - `pinToVisibleBounds = true`
   - åˆå§‹çŠ¶æ€ï¼šä½äº Section 1 çš„é¡¶éƒ¨ï¼ˆSection 0 ä¸‹æ–¹ï¼‰
   - æ»šåŠ¨æ—¶ï¼šè·Ÿéš Section 1 å‘ä¸Šç§»åŠ¨
   - åˆ°è¾¾å±å¹•é¡¶éƒ¨åï¼š**å¸é™„ä½**ï¼Œä¸å†å‘ä¸Šç§»åŠ¨

3. **Section 1 çš„ Content (Page å†…å®¹)**
   - æ¨ªå‘åˆ†é¡µçš„ Page ViewControllers
   - Segment å¸é¡¶åï¼Œç»§ç»­å‚ç›´æ»šåŠ¨

---

## ğŸ¨ æ»šåŠ¨è¡Œä¸ºè¯¦è§£

### é˜¶æ®µ 1: åˆå§‹çŠ¶æ€ (offsetY = 0)
```
è§†å£é¡¶éƒ¨
â”‚
â”œâ”€ Section 0 (é«˜åº¦ 200pt)
â”‚  â””â”€ é¡¶éƒ¨å†…å®¹å®Œå…¨å¯è§
â”‚
â”œâ”€ Section 1 Header (é«˜åº¦ 44pt)
â”‚  â””â”€ Segment ä½äº Section 0 ä¸‹æ–¹
â”‚
â”œâ”€ Section 1 Content
â”‚  â””â”€ Page å†…å®¹å¼€å§‹æ˜¾ç¤º
â”‚
è§†å£åº•éƒ¨
```

### é˜¶æ®µ 2: å¼€å§‹æ»šåŠ¨ (0 < offsetY < 200)
```
è§†å£é¡¶éƒ¨
â”‚
â”œâ”€ Section 0 (éƒ¨åˆ†å¯è§)
â”‚  â””â”€ é¡¶éƒ¨å†…å®¹æ­£åœ¨å‘ä¸Šæ»šå‡º
â”‚
â”œâ”€ Section 1 Header
â”‚  â””â”€ Segment è·Ÿéšå‘ä¸Šç§»åŠ¨
â”‚
â”œâ”€ Section 1 Content
â”‚  â””â”€ æ›´å¤š Page å†…å®¹è¿›å…¥è§†å£
â”‚
è§†å£åº•éƒ¨
```

### é˜¶æ®µ 3: Segment åˆ°è¾¾é¡¶éƒ¨ (offsetY â‰¥ 200)
```
è§†å£é¡¶éƒ¨
â”‚
â”œâ”€ Section 1 Header â­ å¸é™„åœ¨æ­¤ï¼
â”‚  â””â”€ Segment åœæ­¢ç§»åŠ¨
â”‚
â”œâ”€ Section 1 Content
â”‚  â””â”€ Page å†…å®¹ç»§ç»­æ»šåŠ¨
â”‚  â””â”€ (Section 0 å·²å®Œå…¨åœ¨å±å¹•å¤–)
â”‚
è§†å£åº•éƒ¨
```

---

## ğŸ”§ ä»£ç å®ç°

### å®Œæ•´çš„ Layout é…ç½®

```swift
private func createLayout() -> UICollectionViewLayout {
    UICollectionViewCompositionalLayout { sectionIndex, _ in
        switch sectionIndex {
        case 0:
            // Section 0: é¡¶éƒ¨å…±äº«å†…å®¹
            return self.createStaticHeaderSection()
        case 1:
            // Section 1: åˆ†é¡µå†…å®¹ + å¸é¡¶ Segment
            return self.createPagingSection()
        default:
            return nil
        }
    }
}

private func createStaticHeaderSection() -> NSCollectionLayoutSection {
    let item = NSCollectionLayoutItem(
        layoutSize: .init(widthDimension: .fractionalWidth(1.0), 
                         heightDimension: .absolute(200))
    )
    let group = NSCollectionLayoutGroup.vertical(
        layoutSize: .init(widthDimension: .fractionalWidth(1.0), 
                         heightDimension: .absolute(200)),
        subitems: [item]
    )
    return NSCollectionLayoutSection(group: group)
}

private func createPagingSection() -> NSCollectionLayoutSection {
    // æ¨ªå‘åˆ†é¡µçš„ Page
    let item = NSCollectionLayoutItem(
        layoutSize: .init(widthDimension: .fractionalWidth(1.0), 
                         heightDimension: .fractionalHeight(1.0))
    )
    let group = NSCollectionLayoutGroup.horizontal(
        layoutSize: .init(widthDimension: .fractionalWidth(1.0), 
                         heightDimension: .estimated(600)),
        subitems: [item]
    )
    
    let section = NSCollectionLayoutSection(group: group)
    section.orthogonalScrollingBehavior = .groupPaging
    
    // â­ å¸é¡¶çš„ Segment Header
    let header = NSCollectionLayoutBoundarySupplementaryItem(
        layoutSize: .init(widthDimension: .fractionalWidth(1.0), 
                         heightDimension: .absolute(44)),
        elementKind: UICollectionView.elementKindSectionHeader,
        alignment: .top
    )
    header.pinToVisibleBounds = true  // â­ å¸é¡¶
    header.zIndex = 2                 // â­ ç¡®ä¿åœ¨æœ€ä¸Šå±‚
    
    section.boundarySupplementaryItems = [header]
    return section
}
```

---

## ğŸ“Š æ•°æ®ç»“æ„

```swift
private func applySnapshot() {
    var snapshot = NSDiffableDataSourceSnapshot<Int, Int>()
    snapshot.appendSections([0, 1])
    
    // Section 0: é¡¶éƒ¨å…±äº«å†…å®¹ï¼ˆ1 ä¸ª itemï¼‰
    snapshot.appendItems([-1], toSection: 0)
    
    // Section 1: ä¸‰ä¸ªåˆ†é¡µï¼ˆ3 ä¸ª itemï¼‰
    snapshot.appendItems([0, 1, 2], toSection: 1)
    
    dataSource.apply(snapshot, animatingDifferences: false)
}
```

---

## ğŸ¯ å…³é”®ç‚¹

### 1. `pinToVisibleBounds = true`
è¿™æ˜¯å®ç°å¸é¡¶çš„**æ ¸å¿ƒå±æ€§**ï¼š
- âœ… Header ä¼šåœ¨æ»šåŠ¨åˆ°å±å¹•é¡¶éƒ¨æ—¶**åœæ­¢ç§»åŠ¨**
- âœ… åªå¯¹ `NSCollectionLayoutBoundarySupplementaryItem` æœ‰æ•ˆ
- âœ… è‡ªåŠ¨å¤„ç†å¸é™„é€»è¾‘ï¼Œä¸éœ€è¦æ‰‹åŠ¨è®¡ç®—

### 2. `zIndex = 2`
ç¡®ä¿ Segment Header åœ¨å…¶ä»–å†…å®¹ä¹‹ä¸Šï¼š
- Section 0 çš„å†…å®¹ä¼šæ»šåŠ¨åˆ° Segment ä¸‹æ–¹
- Segment å§‹ç»ˆä¿æŒå¯è§

### 3. Section åˆ†ç¦»
å°†é¡¶éƒ¨å†…å®¹å’Œåˆ†é¡µå†…å®¹åˆ†æˆä¸¤ä¸ª Sectionï¼š
- **Section 0**: æ™®é€šå†…å®¹ï¼Œä¼šæ»šå‡ºå±å¹•
- **Section 1**: æœ‰å¸é¡¶ Header çš„åˆ†é¡µå†…å®¹

---

## ğŸ†š ä¸å…¶ä»–æ–¹æ¡ˆå¯¹æ¯”

### æ–¹æ¡ˆ 1: æ‰€æœ‰å†…å®¹åœ¨ä¸€ä¸ª Sectionï¼ˆä¸æ¨èï¼‰
```swift
// âŒ é—®é¢˜ï¼šæ— æ³•å®ç°"é¡¶éƒ¨å†…å®¹æ»šå‡ºå Segment æ‰å¸é¡¶"
section.boundarySupplementaryItems = [header]
header.pinToVisibleBounds = true  
// Header ä¼šç«‹å³å¸é¡¶ï¼Œé¡¶éƒ¨å†…å®¹æ— æ³•å æ®ç©ºé—´
```

### æ–¹æ¡ˆ 2: ä½¿ç”¨ UIScrollView + æ‰‹åŠ¨ç®¡ç†ï¼ˆå¤æ‚ï¼‰
```swift
// âŒ éœ€è¦æ‰‹åŠ¨è®¡ç®—æ»šåŠ¨ä½ç½®
// âŒ éœ€è¦æ‰‹åŠ¨è°ƒæ•´ Segment çš„ frame
// âŒ ä»£ç å¤æ‚ï¼Œå®¹æ˜“å‡º bug
```

### æ–¹æ¡ˆ 3: Compositional Layout ä¸¤ä¸ª Sectionï¼ˆâœ… æ¨èï¼‰
```swift
// âœ… ç®€å•ç›´æ¥
// âœ… è‡ªåŠ¨å¤„ç†å¸é¡¶é€»è¾‘
// âœ… æ€§èƒ½ä¼˜ç§€
```

---

## ğŸ“± çœŸå®åº”ç”¨ç¤ºä¾‹

è¿™ç§æ•ˆæœåœ¨å¾ˆå¤šä¸»æµ App ä¸­ä½¿ç”¨ï¼š

### å¾®åšè¯¦æƒ…é¡µ
```
[ç”¨æˆ·å¤´åƒã€æ˜µç§°ã€å‘å¸ƒæ—¶é—´]  â† Section 0
[è½¬å‘][è¯„è®º][ç‚¹èµ]          â† å¸é¡¶ Segment
[è¯„è®ºåˆ—è¡¨...]              â† Section 1 å†…å®¹
```

### å°çº¢ä¹¦è¯¦æƒ…é¡µ
```
[å›¾ç‰‡è½®æ’­ã€ä½œè€…ä¿¡æ¯]        â† Section 0
[ç¬”è®°][è¯„è®º]              â† å¸é¡¶ Segment
[è¯„è®ºåˆ—è¡¨...]              â† Section 1 å†…å®¹
```

### YouTube è§†é¢‘è¯¦æƒ…
```
[è§†é¢‘æ’­æ”¾å™¨]               â† Section 0
[ç®€ä»‹][è¯„è®º]              â† å¸é¡¶ Segment
[è¯„è®ºåˆ—è¡¨...]              â† Section 1 å†…å®¹
```

---

## ğŸ¨ è‡ªå®šä¹‰è°ƒæ•´

### è°ƒæ•´é¡¶éƒ¨å†…å®¹é«˜åº¦
```swift
layoutSize: .init(widthDimension: .fractionalWidth(1.0), 
                 heightDimension: .absolute(300))  // æ”¹ä¸º 300pt
```

### è°ƒæ•´ Segment é«˜åº¦
```swift
layoutSize: .init(widthDimension: .fractionalWidth(1.0), 
                 heightDimension: .absolute(60))  // æ”¹ä¸º 60pt
```

### è°ƒæ•´å¸é¡¶ä½ç½®ï¼ˆåŠ å…¥åç§»ï¼‰
```swift
header.pinToVisibleBounds = true
header.zIndex = 2

// å¦‚æœéœ€è¦åç§»ï¼ˆæ¯”å¦‚å¯¼èˆªæ ä¸‹æ–¹ï¼‰
// éœ€è¦é€šè¿‡ contentInset è°ƒæ•´
collectionView.contentInset = UIEdgeInsets(top: 88, left: 0, bottom: 0, right: 0)
```

---

## âœ… éªŒè¯æ•ˆæœ

è¿è¡Œé¡¹ç›®åï¼š

1. **åˆå§‹çŠ¶æ€**ï¼šçœ‹åˆ°é¡¶éƒ¨å†…å®¹ + Segment + Page å†…å®¹
2. **å¼€å§‹æ»šåŠ¨**ï¼šä¸‰è€…ä¸€èµ·å‘ä¸Šç§»åŠ¨
3. **ç»§ç»­æ»šåŠ¨**ï¼šé¡¶éƒ¨å†…å®¹é€æ¸æ¶ˆå¤±
4. **Segment åˆ°é¡¶**ï¼šSegment å¸é™„ï¼Œä¸å†ç§»åŠ¨
5. **ç»§ç»­æ»šåŠ¨**ï¼šåªæœ‰ Page å†…å®¹æ»šåŠ¨

è¿™å°±æ˜¯ä½ æƒ³è¦çš„æ•ˆæœï¼ğŸ‰

---

## ğŸ“ æ€»ç»“

é€šè¿‡ Compositional Layout çš„ `pinToVisibleBounds` å±æ€§ï¼Œæˆ‘ä»¬å®ç°äº†ï¼š

- âœ… é¡¶éƒ¨å†…å®¹å¯ä»¥æ»šå‡ºå±å¹•
- âœ… Segment æ»šåŠ¨åˆ°é¡¶éƒ¨åè‡ªåŠ¨å¸é™„
- âœ… Segment å¸é¡¶åï¼Œåªæœ‰ Page å†…å®¹æ»šåŠ¨
- âœ… æ— éœ€æ‰‹åŠ¨è®¡ç®—ï¼Œç³»ç»Ÿè‡ªåŠ¨å¤„ç†
- âœ… æ€§èƒ½ä¼˜ç§€ï¼Œæµç•…é¡ºæ»‘

è¿™æ˜¯ iOS åŸç”Ÿçš„æœ€ä½³å®è·µæ–¹æ¡ˆï¼ğŸš€
